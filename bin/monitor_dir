#!/bin/bash -e

# Use with crontab entry like:
#   */5 *   *   *   *     $HOME/bin/monitor_dir /path/to/something

if [ -z "$1" ]; then
	echo "Usage $0 dir [monitor_file] [ls-options]"
	exit 1
fi
mon="${2:-$1/.monitor_dir}"
mon_tmp="${mon}_tmp"

ls "${3:--tlR}" "$1" > "$mon_tmp"
if [ -r "$mon" ] && ! cmp -s "$mon" "$mon_tmp" && [ -n "$(ls "$1")" ]; then
	diff "$mon" "$mon_tmp" | grep '^> ' | sed 's/^> //'
fi
mv "$mon_tmp" "$mon"

